{% extends 'cmsbase.html' %}
{% load compress static %}
{% block title %} {{block.super}} | CMS | Galerie Details{% endblock %}

{% block content %}
<div class="container mx-auto mt-8">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <h1 class="text-2xl">
      Galerien – Übersicht
      <span class="ml-2 text-sm text-gray-500">({{ total_count }} Galerien)</span>
    </h1>

    <div class="flex items-center gap-3">
      <!-- Pro-Seite Auswahl -->
      <form method="get" class="flex items-center gap-2">
        <label class="text-sm text-gray-600">Pro Seite</label>
        <select name="per_page" class="rounded-md border-gray-300 text-sm" onchange="this.form.submit()">
          <option value="6"  {% if per_page == 6  %}selected{% endif %}>6</option>
          <option value="12" {% if per_page == 12 %}selected{% endif %}>12</option>
          <option value="24" {% if per_page == 24 %}selected{% endif %}>24</option>
          <option value="48" {% if per_page == 48 %}selected{% endif %}>48</option>
        </select>
        {# andere GET-Parameter erhalten (falls später Filter dazukommen) #}
        {% for key, val in request.GET.items %}
          {% if key != 'per_page' and key != 'page' %}
            <input type="hidden" name="{{ key }}" value="{{ val }}">
          {% endif %}
        {% endfor %}
      </form>

      <a href="{% url 'cms:galery-create' %}"
         class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
        Galerie erstellen
      </a>
    </div>
  </div>

  {% if galerien %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-6">
      {% for galery in galerien %}
        <div class="bg-white text-black border-gray-200 rounded-2xl shadow-lg border h-80 w-full flex flex-col">
          <div class="p-3">
            <h2 class="text-xl font-medium text-center flex justify-center items-center">
              {{ galery.title }}
              {% if galery.active %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-400 text-black ml-4">
                  Aktiv
                </span>
              {% else %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-400 text-black ml-4">
                  Inaktiv
                </span>
              {% endif %}
            </h2>
          </div>
          <hr class="w-full">
          <div class="p-3 grid grid-cols-4 gap-3 mt-2 flex-1 overflow-auto">
            {# Nur erste 8 Thumbnails zeigen, um Karten kompakt zu halten #}
            {% for image in galery.images.all|slice:":8" %}
              <img class="rounded-2xl w-full h-20 object-cover"
                   src="{{ image.upload.url }}"
                   alt="{{ galery.title }}">
            {% endfor %}
            {% if galery.images.count > 8 %}
              <div class="col-span-4 text-center text-xs text-gray-500 mt-1">
                + {{ galery.images.count|add:"-8" }} weitere…
              </div>
            {% endif %}
          </div>
          <div class="flex justify-center items-end mt-1 mb-4">
            <a href="/cms/galery/{{ galery.id }}/"
               class="mt-auto bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-700">
              Bearbeiten
            </a>
          </div>
        </div>
      {% endfor %}
    </div>

    {# Pagination #}
    {% if page_obj.paginator.num_pages > 1 %}
      <nav class="flex items-center justify-between mt-6" aria-label="Pagination">
        <div class="text-sm text-gray-600">
          Seite {{ page_obj.number }} von {{ page_obj.paginator.num_pages }} –
          Einträge {{ page_obj.start_index }}–{{ page_obj.end_index }} von {{ page_obj.paginator.count }}
        </div>

        <div class="inline-flex items-center space-x-1">
          {% if page_obj.has_previous %}
            <a href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.previous_page_number }}"
               class="px-3 py-1 rounded-md border text-sm hover:bg-gray-50">‹ Zurück</a>
          {% else %}
            <span class="px-3 py-1 rounded-md border text-sm text-gray-400">‹ Zurück</span>
          {% endif %}

          {% for num in page_obj.paginator.page_range %}
            {% if num == page_obj.number %}
              <span class="px-3 py-1 rounded-md bg-blue-500 text-white text-sm">{{ num }}</span>
            {% elif num >= page_obj.number|add:-2 and num <= page_obj.number|add:2 %}
              <a href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ num }}"
                 class="px-3 py-1 rounded-md border text-sm hover:bg-gray-50">{{ num }}</a>
            {% elif num == 1 or num == page_obj.paginator.num_pages %}
              <a href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ num }}"
                 class="px-3 py-1 rounded-md border text-sm hover:bg-gray-50">{{ num }}</a>
            {% elif forloop.first or forloop.last %}
              <span class="px-2 text-gray-400">…</span>
            {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
            <a href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.next_page_number }}"
               class="px-3 py-1 rounded-md border text-sm hover:bg-gray-50">Weiter ›</a>
          {% else %}
            <span class="px-3 py-1 rounded-md border text-sm text-gray-400">Weiter ›</span>
          {% endif %}
        </div>
      </nav>
    {% endif %}
  {% else %}
    <div class="mt-10 text-gray-500">Keine Galerien vorhanden.</div>
  {% endif %}
</div>
{% endblock %}
